---
title: "DIF"
author: "Xiaoliang Zhou"
date: `r format(Sys.time(), "%d %B, %Y")`
output: html_document
---

# Install software (Refer to 'explore data.Rmd' in 'rCode' foler)

```{r}
library(RaschKit)
install_packages_ls()
```

# Explore function

Open this .Rmd file via 'xxx.Rproj' in working directory.
Select function below for different cases. Functions would output instructions 
on where to find report and/or result files.

## Use data as input; use tow/more dichotomous DIF variables

Arguments below may be useful for specific purposes.
- poly_key: TRUE if polytomous items exist in test.
- step (useful only when poly_key=TRUE):
  - FALSE: 'item+DIFVar+item*DIFVar+item*step;' generated for ConQuest;
    model results used for item delta DIF analysis.
  - TRUE: 'item+DIFVar+item*DIFVar+item*step*DIFVar;' generated for ConQuest;
    model results used for item step DIF analysis.
- output_ready: TURE when ConQuest output files are in 'DIF' folder.
- iterative: FALSE if to compare with results from using ACER DIF templates.

```{r}
DIF_domain(test, data=NULL, var_ls=NULL, n_cov=NULL, pid=NULL,
           keys=NULL, labels=NULL)
```

## Use data as input; use one dichotomous DIF variable

### One domain in test

```{r}
# dichotomous DIF variable
DIF_dim_one(method='chi_square', vars=c('Girls', 'Boys'), data=elena, 
            test='ELNA', DIFVar="gender", pid="IDSTUD", n_cov=9)

# polytomous DIF variable
DIF_dim_one(method='Bonferroni', data=elena, test='ELNA', 
            DIFVar="quintile", pid="IDSTUD", n_cov=9)

# polytomous DIF variable
DIF_dim_one(method='Facet', data=elena, test='ELNA', DIFVar="quintile", 
            pid="IDSTUD", n_cov=9)
```

To extract and combine DIF analysis results (.xlsx, .pdf) from tests on one 
dichotomous DIF variable, run the following code.

```{r}
read2one(subfolder='DIF', tests=dms, vars=c('Male', 'Female'))
```

### Two/more domains in test

```{r}
# dichotomous DIF variable
DIF_dim_multi(method='chi_square', vars=c('Girls', 'Boys'), DIFVar="studGender", 
              data=df_DIF, test='ELANA', pid='studentId', n_cov=5,
              n_dims=c(901, 171), dim_names=c('HUM', 'Maths'), 
              regr_vec_char=c('countryName', 'studAge'), 
              section_extr='group countryName;\n')

# polytomous DIF variable
DIF_dim_multi(method='Bonferroni', DIFVar="studAge", data=df_DIF, test='ELANA', 
              pid='studentId', n_cov=5, n_dims=c(901, 171), 
              dim_names=c('HUM', 'Maths'), regr_vec_char=c('countryName', 'studGender'), 
              quick=TRUE, section_extr='group countryName;\n')
```

## Use dataframe or list as input

Users prepare df/df_ls as argument for function.

```{r}
# dichotomous DIF variable
DIF_dich(df, DIFVar='gender', test='N_1', vars=c('Girls', 'Boys'))

# polytomous DIF variable
DIF_poly(df_ls, DIFVar, cats, labels, test)
```

## Use CQ output (.shw, .its files) as input

Use of those functions assumes that .shw and other files from facet model are in 'DIF' folder.

```{r}
# dichotomous DIF variable
DIF_dich_its_shw(DIFVar='gender', test='N_1', vars=c('Girls', 'Boys'))

# polytomous DIF variable
DIF_poly_shw(DIFVar='quintile', labels=labels, test='numeracy')
```