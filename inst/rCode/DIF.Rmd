---
title: "DIF"
author: "Xiaoliang Zhou"
date: '2022-06-17'
output: html_document
---

# Install software (Refer to 'explore data.Rmd' in 'rCode' foler)

```{r}
library(RaschKit)
install_packages_ls()
create_folders() 
```

```{r}
# 1. move this .Rmd file into the 'rCode' folder just created.
# 2. Put received files into 'dataRaw' folder.
# 3. Open this .Rmd file via 'xxx.Rproj'.
# 4. Select functions proper. Functions would output instructions on 
#    where to find the .html report and key result files.
```

# ###### DIF analysis: Data as input; tow/more dichotomous DIF variables

```{r}
DIF_domain(test, data=NULL, var_ls=NULL, n_cov=NULL, pid=NULL,
           keys=NULL, labels=NULL)

# ##### Some useful arguments: ###### 
# poly_key: TRUE if polytomous items exist
# step (useful when poly_key=TRUE):
#   FALSE: 'item+DIFVar+item*DIFVar+item*step;' for ConQuest;
#     model results used for item delta DIF analysis
#   TRUE: 'item+DIFVar+item*DIFVar+item*step*DIFVar;' for ConQuest;
#     model results used for item step DIF analysis
# output_ready: TURE when ConQuest output files are ready
# iterative: FALSE if to compare with results from using DIF templates
```

# ###### DIF analysis: Data as input; one DIF variable

# One domain in test

```{r}
# dichotomous DIF variable
DIF_dim_one(method='chi_square', vars=c('Girls', 'Boys'), data=elena, 
            test='ELNA', DIFVar="gender", pid="IDSTUD", n_cov=9,
            regr_vec_char=c('province', 'quintile'), quick=TRUE)

# polytomous DIF variable
DIF_dim_one(method='Bonferroni', data=elena, test='ELNA', 
            DIFVar="quintile", pid="IDSTUD", n_cov=9, 
            regr_vec_char=c('province', 'gender'), miss_code=NULL)

# polytomous DIF variable
DIF_dim_one(method='Facet', data=elena, test='ELNA', DIFVar="quintile", 
            pid="IDSTUD", n_cov=9, regr_vec_char=c('province', 'gender'))
```

```{r}
# extract and combine DIF analysis from tests on one DIF variable
# plots will be combined also
read2one(subfolder=here::here('DIF'), tests=dms, vars=c('Male', 'Female'))
```

# Two/more domains in test

```{r}
# dichotomous DIF variable
DIF_dim_multi(method='chi_square', vars=c('Girls', 'Boys'), DIFVar="studGender", 
              data=df_DIF, test='ELANA', pid='studentId', n_cov=5,
              n_dims=c(901, 171), dim_names=c('HUM', 'Maths'), 
              regr_vec_char=c('countryName', 'studAge'), 
              section_extr='group countryName;\n')

# polytomous DIF variable
DIF_dim_multi(method='Bonferroni', DIFVar="studAge", data=df_DIF, test='ELANA', 
              pid='studentId', n_cov=5, n_dims=c(901, 171), 
              dim_names=c('HUM', 'Maths'), regr_vec_char=c('countryName', 'studGender'), 
              quick=TRUE, section_extr='group countryName;\n')
```

# ###### DIF analysis: Dataframe or list as input

```{r}
# Users prepare df or df_ls
# use ?DIF_dich, ?DIF_poly to learn more

# dichotomous DIF variable
DIF_dich(df, DIFVar='gender', test='N_1', vars=c('Girls', 'Boys'))

# polytomous DIF variable
DIF_poly(df_ls, DIFVar, cats, labels, test)
```

# ###### DIF analysis: CQ output (.shw, .its files) as input

Use of those functions assumes that .shw and other files from facet model are in 'DIF' folder.

```{r}
# dichotomous DIF variable
DIF_dich_its_shw(DIFVar='gender', test='N_1', vars=c('Girls', 'Boys'))

# polytomous DIF variable: This will generate an .html report
DIF_poly_shw(DIFVar='quintile', labels=labels, test='numeracy')
```

